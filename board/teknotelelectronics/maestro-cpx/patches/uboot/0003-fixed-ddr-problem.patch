From 93c8c115fcc4a39a3219a5b5167fed076ad6f5aa Mon Sep 17 00:00:00 2001
From: Mahdi Noori <nekorawesh@gmail.com>
Date: Thu, 31 Dec 2020 11:22:04 +0300
Subject: [PATCH] fixed ddr problem

---
 .../dts/maestro-cpx-ddr3-1x4Gb-1066-binG.dtsi |  6 ++--
 arch/arm/dts/maestro-cpx.dts                  | 28 +++++++++----------
 2 files changed, 18 insertions(+), 16 deletions(-)

diff --git a/arch/arm/dts/maestro-cpx-ddr3-1x4Gb-1066-binG.dtsi b/arch/arm/dts/maestro-cpx-ddr3-1x4Gb-1066-binG.dtsi
index 058a1d714e..09da7324f5 100755
--- a/arch/arm/dts/maestro-cpx-ddr3-1x4Gb-1066-binG.dtsi
+++ b/arch/arm/dts/maestro-cpx-ddr3-1x4Gb-1066-binG.dtsi
@@ -103,11 +103,11 @@
 #define DDR_ZQ0CR1 0x00000038
 #define DDR_DX0GCR 0x0000CE81
 #define DDR_DX0DLLCR 0x40000000
-#define DDR_DX0DQTR 0x33333333
+#define DDR_DX0DQTR 0xFFFFFFFF
 #define DDR_DX0DQSTR 0x3DB02000
 #define DDR_DX1GCR 0x0000CE81
 #define DDR_DX1DLLCR 0x40000000
-#define DDR_DX1DQTR 0x33333333
+#define DDR_DX1DQTR 0xFFFFFFFF
 #define DDR_DX1DQSTR 0x3DB02000
 #define DDR_DX2GCR 0x0000CE80
 #define DDR_DX2DLLCR 0x40000000
@@ -117,3 +117,5 @@
 #define DDR_DX3DLLCR 0x40000000
 #define DDR_DX3DQTR 0xFFFFFFFF
 #define DDR_DX3DQSTR 0x3DB02000
+
+#include "stm32mp15-ddr.dtsi"
diff --git a/arch/arm/dts/maestro-cpx.dts b/arch/arm/dts/maestro-cpx.dts
index d205be755e..9aa973754d 100755
--- a/arch/arm/dts/maestro-cpx.dts
+++ b/arch/arm/dts/maestro-cpx.dts
@@ -41,45 +41,45 @@
 		ranges;
 
 		/* USER CODE BEGIN reserved-memory */
-		retram: retram@0x38000000 {
+		mcuram2: mcuram2@10000000 {
 			compatible = "shared-dma-pool";
-			reg = <0x38000000 0x10000>;
+			reg = <0x10000000 0x40000>;
 			no-map;
 		};
 
-		mcuram: mcuram@0x30000000 {
+		vdev0vring0: vdev0vring0@10040000 {
 			compatible = "shared-dma-pool";
-			reg = <0x30000000 0x40000>;
+			reg = <0x10040000 0x1000>;
 			no-map;
 		};
 
-		mcuram2: mcuram2@0x10000000 {
+		vdev0vring1: vdev0vring1@10041000 {
 			compatible = "shared-dma-pool";
-			reg = <0x10000000 0x40000>;
+			reg = <0x10041000 0x1000>;
 			no-map;
 		};
 
-		vdev0vring0: vdev0vring0@10040000 {
+		vdev0buffer: vdev0buffer@10042000 {
 			compatible = "shared-dma-pool";
-			reg = <0x10040000 0x2000>;
+			reg = <0x10042000 0x4000>;
 			no-map;
 		};
 
-		vdev0vring1: vdev0vring1@10042000 {
+		mcuram: mcuram@30000000 {
 			compatible = "shared-dma-pool";
-			reg = <0x10042000 0x2000>;
+			reg = <0x30000000 0x40000>;
 			no-map;
 		};
 
-		vdev0buffer: vdev0buffer@10044000 {
+		retram: retram@38000000 {
 			compatible = "shared-dma-pool";
-			reg = <0x10044000 0x4000>;
+			reg = <0x38000000 0x10000>;
 			no-map;
 		};
 		/* USER CODE END reserved-memory */
 
-		gpu_reserved: gpu@dc000000 {
-			reg = <0xdc000000 0x4000000>;
+		gpu_reserved: gpu@da000000 {
+			reg = <0xda000000 0x4000000>;
 			no-map;
 		};
 	};
-- 
2.30.0

